# map_controller.js.coffee

class BackboneLeaflet.Custom.MapController
  _.extend @prototype, Backbone.Events

  default_options:
    latitude: 48.89364
    longitude: 2.33739
    zoom: 15

  constructor: (options)->
    @options = _.defaults(options, @default_options)
    @createBaseIcon()
    @createMap()
    @addMarker([@options.latitude, @options.longitude])

  createMap: ->
    console.log("Lat: #{@options.latitude} Long: #{@options.longitude}")
    @base = L.map('map').setView([@options.latitude, @options.longitude], @options.zoom);
    L.tileLayer('http://{s}.tile.cloudmade.com/ceda08740383477f8dbb3bed2e9c2a47/997/256/{z}/{x}/{y}.png',
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>'
      maxZoom: 18).addTo(@base)

  createBaseIcon: ->
    @base_icon = L.icon(
      iconUrl: "<%= asset_path('marker-icon.png') %>"
      retinaUrl: "<%= asset_path('marker-icon-2x.png') %>"
      shadowUrl: "<%= asset_path('marker-shadow.png') %>"
      iconSize: [25, 41]
      iconAnchor: [12, 41]
      popupAnchor: [1, -34]
      shadowSize: [41, 41])

  addMarker: (lat_long, icon=null)->
    icon ?= @base_icon
    L.marker(lat_long, {icon: icon}).addTo(@base)
